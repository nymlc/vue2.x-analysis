<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>响应式例子</title>
    <style>
        .title {
            color: red;
        }
    </style>
</head>

<body>
    <div id="app">

    </div>
</body>
<script src="./vue-bak.js"></script>
<script>
    function example1() {
        Vue.component('hello', {
            data() {
                const VNode = this.$vnode.constructor
                const vnode = new VNode(
                    'div', 'vnode', [],
                    undefined, undefined, this
                )
                return vnode
            },
            methods: {
                change() {
                    console.log('before change', this.tag)
                    this.tag = 'span'
                    console.log('after change', this.tag)
                }
            },
            template: `<div>
                        {{tag}}
                        <button @click="change">change</button>
                    </div>`
        })
        new Vue({
            data: { title: 'data是VNode实例' },
            template: `<div>
                <p class="title">{{title}}</p>
                <hello />
                </div>`
        }).$mount('#app')
    }
    function example2() {
        new Vue({
            data: new Vue(),
            template: `<div>
                <p class="title">data是Vue实例</p>
                {{_isVue}}
                </div>`
        }).$mount('#app')
    }
    function example3() {
        window.data = {
            tag: ''
        }
        Vue.component('hello', {
            data() {
                return data
            },
            computed: {
                vmCount() {
                    return this.$data.__ob__.vmCount
                }
            },
            template: `<div>
                    {{tag}}hello{{vmCount}}
                    </div>`
        })
        new Vue({
            data: { title: 'vmCount' },
            template: `<div>
                <p class="title">{{title}}</p>
                <hello />
                <hello />
                <hello />
                </div>`
        }).$mount('#app')
    }
    function example4() {
        window.data = {
            a: {
                b: 1
            }
        }
        window.ln = new Vue({
            data,
            methods: {
                add() {
                    const nKey = 'nVal'
                    this.$set(this._data, nKey, {})
                    Object.defineProperty(this, nKey, {
                        enumerable: true,
                        configurable: true,
                        get: function() {
                            return this._data[nKey]
                        },
                        set: function(val) {
                            this._data[nKey] = val
                        }
                    })
                    this.$set(this._data.a, 'c', {})
                    this.$watch(nKey, () => {
                        console.log(`${nKey} change`)
                    })
                    this.$watch('a.c', () => {
                        console.log('a.c change')
                    })
                },
                trigger() {
                    this.nVal = 666
                    this.a.c = 666
                }
            },
            template: `<div>
                <p class="title">给根data设置新属性，得注释掉源码这段提示方可</p>
                <code style="white-space: pre-wrap;">
if (target._isVue || (ob && ob.vmCount)) {
    process.env.NODE_ENV !== 'production' && warn(
        'Avoid adding reactive properties to a Vue instance or its root $data ' +
        'at runtime - declare it upfront in the data option.'
    )
    return val
}    
                </code>
                        <button @click="add">add</button>
                        <button @click="trigger">trigger</button>
                </div>`
        }).$mount('#app')
    }
    window[`example${location.hash.substring(1)}`]()
</script>

</html>